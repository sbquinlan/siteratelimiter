var parcelHelpers = require("@parcel/transformer-js/src/esmodule-helpers.js");
var _webextensionPolyfill = require("webextension-polyfill");
var _webextensionPolyfillDefault = parcelHelpers.interopDefault(_webextensionPolyfill);
// we want to write to storage when we stop looking at a site.
// this happens when we: 
// - navigate to a new page
// - tab to a new tab
// - close a tab (switch to a new tab?)
// in order to know length of time, we need to track when a page starts being active
// this happens when we actively nagivate to a new page or a tab starts being active
const updateDomainTime = ({ url , start  })=>{
    const elapsed = Date.now() - start;
    return _webextensionPolyfillDefault.default.storage.sync.get({
        [url]: null
    }).then(({ url: total  })=>_webextensionPolyfillDefault.default.storage.sync.set({
            [url]: 0 + total + elapsed
        })
    );
};
const updateActiveTab = (tab)=>{
    _webextensionPolyfillDefault.default.storage.local.get('active').then(({ active  })=>{
        if (!active) return Promise.resolve(null);
        return updateDomainTime(active);
    }).then(()=>_webextensionPolyfillDefault.default.storage.local.set({
            "active": {
                "url": tab.url,
                "start": Date.now()
            }
        })
    );
};
_webextensionPolyfillDefault.default.tabs.onUpdated.addListener((tabId, changeInfo, tab)=>{
    if (tab.active) updateActiveTab(tab);
// some other tab changed
}, {
    properties: [
        "url"
    ]
});
_webextensionPolyfillDefault.default.tabs.onActivated.addListener(({ prev , tabId , windowId  })=>{
});
